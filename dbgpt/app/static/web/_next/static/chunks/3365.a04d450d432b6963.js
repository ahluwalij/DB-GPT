"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3365],{62048:function(e,t,l){l.r(t),l.d(t,{default:function(){return eI}});var a=l(96469),s=l(45277),n=l(40789),r=l(78638),o=l(7289),i=l(40144),c=l(26869),d=l.n(c),u=l(45875),x=l(38497),m=l(45045),p=l(76592),h=l(18458),f=()=>{let{history:e,setHistory:t,chatId:l,model:a,docId:o}=(0,x.useContext)(s.p),{chat:i}=(0,r.Z)({queryAgentURL:"/knowledge/document/summary"}),c=(0,x.useCallback)(async e=>{let[,s]=await (0,n.Vx)((0,n.$i)(l)),r=[...s,{role:"human",context:"",model_name:a,order:0,time_stamp:0},{role:"view",context:"",model_name:a,order:0,time_stamp:0,retry:!0}],c=r.length-1;t([...r]),await i({data:{doc_id:e||o,model_name:a},chatId:l,onMessage:e=>{r[c].context=e,t([...r])}})},[e,a,o,l]);return c},v=l(48323),g=l(40371),j=l(81894),w=l(88861),b=l(74865),_=l(18521),y=l(35569),Z=l(93486),N=l.n(Z),k=l(44766),C=l(56841),P=l(96434),S=l(6319),R=l(75148),E=l(87313),I=l(67901),D=l(86560);function M(e){let{document:t}=e;switch(t.status){case"RUNNING":return(0,a.jsx)(I.Rp,{});case"FINISHED":default:return(0,a.jsx)(I.s2,{});case"FAILED":return(0,a.jsx)(D.Z,{})}}function F(e){let{documents:t,dbParam:l}=e,s=(0,E.useRouter)(),n=e=>{s.push("/knowledge/chunk/?spaceName=".concat(l,"&id=").concat(e))};return(null==t?void 0:t.length)?(0,a.jsx)("div",{className:"absolute flex overflow-scroll h-12 top-[-35px] w-full z-10",children:t.map(e=>{let t;switch(e.status){case"RUNNING":t="#2db7f5";break;case"FINISHED":default:t="#87d068";break;case"FAILED":t="#f50"}return(0,a.jsx)(_.Z,{title:e.result,children:(0,a.jsxs)(R.ZP,{style:{color:t},onClick:()=>{n(e.id)},className:"shrink flex items-center mr-3",children:[(0,a.jsx)(M,{document:e}),e.doc_name]})},e.id)})}):null}var L=l(57618),O=l(86916);function z(e){let{dbParam:t,setDocId:l}=(0,x.useContext)(s.p),{onUploadFinish:r,handleFinish:o}=e,i=f(),[c,d]=(0,x.useState)(!1),u=async e=>{d(!0);let a=new FormData;a.append("doc_name",e.file.name),a.append("doc_file",e.file),a.append("doc_type","DOCUMENT");let s=await (0,n.Vx)((0,n.iG)(t||"default",a));if(!s[1]){d(!1);return}l(s[1]),r(),d(!1),null==o||o(!0),await i(s[1]),null==o||o(!1)};return(0,a.jsx)(O.default,{customRequest:u,showUploadList:!1,maxCount:1,multiple:!1,className:"absolute z-10 top-2 left-2",accept:".pdf,.ppt,.pptx,.xls,.xlsx,.doc,.docx,.txt,.md",children:(0,a.jsx)(R.ZP,{loading:c,size:"small",shape:"circle",icon:(0,a.jsx)(L.Z,{})})})}var A=l(94078),V=l(95838),$=l(75481),G=l(29478),U=l(26953),q=l(36980),H=l(51645),J=l(98360);let T=e=>{let{data:t,loading:l,submit:s,close:n}=e,{t:r}=(0,C.$G)(),o=e=>()=>{s(e),n()};return(0,a.jsx)("div",{style:{maxHeight:400,overflow:"auto"},children:(0,a.jsx)($.Z,{dataSource:null==t?void 0:t.data,loading:l,rowKey:e=>e.prompt_name,renderItem:e=>(0,a.jsx)($.Z.Item,{onClick:o(e.content),children:(0,a.jsx)(_.Z,{title:e.content,children:(0,a.jsx)($.Z.Item.Meta,{style:{cursor:"copy"},title:e.prompt_name,description:r("Prompt_Info_Scene")+"：".concat(e.chat_scene,"，")+r("Prompt_Info_Sub_Scene")+"：".concat(e.sub_chat_scene)})})},e.prompt_name)})})};var B=e=>{let{submit:t}=e,{t:l}=(0,C.$G)(),[s,n]=(0,x.useState)(!1),[r,o]=(0,x.useState)("common"),{data:i,loading:c}=(0,V.Z)(()=>(0,A.PR)("/prompt/list",{prompt_type:r}),{refreshDeps:[r],onError:e=>{b.ZP.error(null==e?void 0:e.message)}});return(0,a.jsx)(G.ZP,{theme:{components:{Popover:{minWidth:250}}},children:(0,a.jsx)(U.Z,{title:(0,a.jsx)(q.default.Item,{label:"Prompt "+l("Type"),children:(0,a.jsx)(H.default,{style:{width:150},value:r,onChange:e=>{o(e)},options:[{label:l("Public")+" Prompts",value:"common"},{label:l("Private")+" Prompts",value:"private"}]})}),content:(0,a.jsx)(T,{data:i,loading:c,submit:t,close:()=>{n(!1)}}),placement:"topRight",trigger:"click",open:s,onOpenChange:e=>{n(e)},children:(0,a.jsx)(_.Z,{title:l("Click_Select")+" Prompt",children:(0,a.jsx)(J.Z,{className:"bottom-[30%]"})})})})},Q=function(e){let{children:t,loading:l,onSubmit:r,handleFinish:o,placeholder:i,...c}=e,{dbParam:d,scene:u}=(0,x.useContext)(s.p),[m,p]=(0,x.useState)(""),h=(0,x.useMemo)(()=>"chat_knowledge"===u,[u]),[f,v]=(0,x.useState)([]),g=(0,x.useRef)(0);async function j(){if(!d)return null;let[e,t]=await (0,n.Vx)((0,n._Q)(d,{page:1,page_size:g.current}));v((null==t?void 0:t.data)||[])}(0,x.useEffect)(()=>{h&&j()},[d]);let w=async()=>{g.current+=1,await j()};return(0,a.jsxs)("div",{className:"flex-1 relative",children:[(0,a.jsx)(F,{documents:f,dbParam:d}),h&&(0,a.jsx)(z,{handleFinish:o,onUploadFinish:w,className:"absolute z-10 top-2 left-2"}),(0,a.jsx)(S.default.TextArea,{className:"flex-1 ".concat(h?"pl-10":""," pr-10"),size:"large",value:m,autoSize:{minRows:1,maxRows:4},...c,onPressEnter:e=>{if(m.trim()&&13===e.keyCode){if(e.shiftKey){e.preventDefault(),p(e=>e+"\n");return}r(m),setTimeout(()=>{p("")},0)}},onChange:e=>{if("number"==typeof c.maxLength){p(e.target.value.substring(0,c.maxLength));return}p(e.target.value)},placeholder:i}),(0,a.jsx)(R.ZP,{className:"ml-2 flex items-center justify-center absolute right-0 bottom-0",size:"large",type:"text",loading:l,icon:(0,a.jsx)(P.Z,{}),onClick:()=>{r(m)}}),(0,a.jsx)(B,{submit:e=>{p(m+e)}}),t]})},K=l(58064),W=l(55457),X=l(2242),Y=(0,x.memo)(function(e){var t;let{content:l}=e,{scene:n}=(0,x.useContext)(s.p),r="view"===l.role;return(0,a.jsx)("div",{className:d()("relative w-full p-2 md:p-4 rounded-xl break-words",{"bg-white dark:bg-[#232734]":r,"lg:w-full xl:w-full pl-0":["chat_with_db_execute","chat_dashboard"].includes(n)}),children:r?(0,a.jsx)(K.Z,{components:X.Z,rehypePlugins:[W.Z],children:null==(t=l.context)?void 0:t.replace(/<table(\w*=[^>]+)>/gi,"<table $1>").replace(/<tr(\w*=[^>]+)>/gi,"<tr $1>")}):(0,a.jsx)("div",{className:"",children:l.context})})}),ee=l(50898),et=l(53375),el=l(18197),ea=l(1565),es=l(57232),en=l(98924),er=l(80844),eo=l(86250),ei=l(24113),ec=l(57064);let ed={todo:{bgClass:"bg-gray-500",icon:(0,a.jsx)(ee.Z,{className:"ml-2"})},runing:{bgClass:"bg-blue-500",icon:(0,a.jsx)(et.Z,{className:"ml-2"})},failed:{bgClass:"bg-red-500",icon:(0,a.jsx)(el.Z,{className:"ml-2"})},completed:{bgClass:"bg-green-500",icon:(0,a.jsx)(ea.Z,{className:"ml-2"})}};function eu(e){return e.replaceAll("\\n","\n").replace(/<table(\w*=[^>]+)>/gi,"<table $1>").replace(/<tr(\w*=[^>]+)>/gi,"<tr $1>")}var ex=(0,x.memo)(function(e){let{children:t,content:l,isChartChat:n,onLinkClick:r}=e,{scene:o}=(0,x.useContext)(s.p),{context:i,model_name:c,role:u}=l,m="view"===u,{relations:p,value:h,cachePluginContext:f}=(0,x.useMemo)(()=>{if("string"!=typeof i)return{relations:[],value:"",cachePluginContext:[]};let[e,t]=i.split("	relations:"),l=t?t.split(","):[],a=[],s=0,n=e.replace(/<dbgpt-view[^>]*>[^<]*<\/dbgpt-view>/gi,e=>{try{var t;let l=e.replaceAll("\n","\\n").replace(/<[^>]*>|<\/[^>]*>/gm,""),n=JSON.parse(l),r="<custom-view>".concat(s,"</custom-view>");return a.push({...n,result:eu(null!==(t=n.result)&&void 0!==t?t:"")}),s++,r}catch(t){return console.log(t.message,t),e}});return{relations:l,cachePluginContext:a,value:n}},[i]),v=(0,x.useMemo)(()=>({"custom-view"(e){var t;let{children:l}=e,s=+l.toString();if(!f[s])return l;let{name:n,status:r,err_msg:o,result:i}=f[s],{bgClass:c,icon:u}=null!==(t=ed[r])&&void 0!==t?t:{};return(0,a.jsxs)("div",{className:"bg-white dark:bg-[#212121] rounded-lg overflow-hidden my-2 flex flex-col lg:max-w-[80%]",children:[(0,a.jsxs)("div",{className:d()("flex px-4 md:px-6 py-2 items-center text-white text-sm",c),children:[n,u]}),i?(0,a.jsx)("div",{className:"px-4 md:px-6 py-4 text-sm",children:(0,a.jsx)(K.Z,{components:X.Z,rehypePlugins:[W.Z],remarkPlugins:[ei.Z],children:null!=i?i:""})}):(0,a.jsx)("div",{className:"px-4 md:px-6 py-4 text-sm",children:o})]})}}),[i,f]);return m||i?(0,a.jsxs)("div",{className:d()("relative flex flex-wrap w-full p-2 md:p-4 rounded-xl break-words",{"bg-white dark:bg-[#232734]":m,"lg:w-full xl:w-full pl-0":["chat_with_db_execute","chat_dashboard"].includes(o)}),children:[(0,a.jsx)("div",{className:"mr-2 flex flex-shrink-0 items-center justify-center h-7 w-7 rounded-full text-lg sm:mr-4",children:m?(0,ec.A)(c)||(0,a.jsx)(es.Z,{}):(0,a.jsx)(en.Z,{})}),(0,a.jsxs)("div",{className:"flex-1 overflow-hidden items-center text-md leading-8 pb-2",children:[!m&&"string"==typeof i&&i,m&&n&&"object"==typeof i&&(0,a.jsxs)("div",{children:["[".concat(i.template_name,"]: "),(0,a.jsxs)("span",{className:"text-theme-primary cursor-pointer",onClick:r,children:[(0,a.jsx)(er.Z,{className:"mr-1"}),i.template_introduce||"More Details"]})]}),m&&"string"==typeof i&&(0,a.jsx)(K.Z,{components:{...X.Z,...v},rehypePlugins:[W.Z],remarkPlugins:[ei.Z],children:eu(h)}),!!(null==p?void 0:p.length)&&(0,a.jsx)("div",{className:"flex flex-wrap mt-2",children:null==p?void 0:p.map((e,t)=>(0,a.jsx)(eo.Z,{color:"#108ee9",children:e},e+t))})]}),t]}):(0,a.jsx)("div",{className:"h-12"})}),em=l(41708),ep=l(87452),eh=l(74936),ef=l(70224),ev=l(20444),eg=l(33464),ej=l(35802),ew=l(8049),eb=l(62803),e_=l(44984),ey=l(77242),eZ=l(45370),eN=l(533),ek=l(20855),eC=l(81630),eP=e=>{var t;let{conv_index:l,question:r,knowledge_space:o,select_param:i}=e,{t:c}=(0,C.$G)(),{chatId:d}=(0,x.useContext)(s.p),[u,m]=(0,x.useState)(""),[p,h]=(0,x.useState)(4),[f,v]=(0,x.useState)(""),g=(0,x.useRef)(null),[y,Z]=b.ZP.useMessage(),N=(0,x.useCallback)((e,t)=>{t?(0,n.Vx)((0,n.Eb)(d,l)).then(e=>{var t,l,a,s;let n=null!==(t=e[1])&&void 0!==t?t:{};m(null!==(l=n.ques_type)&&void 0!==l?l:""),h(parseInt(null!==(a=n.score)&&void 0!==a?a:"4")),v(null!==(s=n.messages)&&void 0!==s?s:"")}).catch(e=>{console.log(e)}):(m(""),h(4),v(""))},[d,l]),k=(0,eh.Z)(ef.Z)(e=>{let{theme:t}=e;return{backgroundColor:"dark"===t.palette.mode?"#FBFCFD":"#0E0E10",...t.typography["body-sm"],padding:t.spacing(1),display:"flex",alignItems:"center",justifyContent:"center",borderRadius:4,width:"100%",height:"100%"}});return(0,a.jsxs)(ev.L,{onOpenChange:N,children:[Z,(0,a.jsx)(_.Z,{title:c("Rating"),children:(0,a.jsx)(eg.Z,{slots:{root:w.ZP},slotProps:{root:{variant:"plain",color:"primary"}},sx:{borderRadius:40},children:(0,a.jsx)(em.Z,{})})}),(0,a.jsxs)(ej.Z,{children:[(0,a.jsx)(ew.Z,{disabled:!0,sx:{minHeight:0}}),(0,a.jsx)(eb.Z,{sx:{width:"100%",maxWidth:350,display:"grid",gap:3,padding:1},children:(0,a.jsx)("form",{onSubmit:e=>{e.preventDefault(),(0,n.Vx)((0,n.VC)({data:{conv_uid:d,conv_index:l,question:r,knowledge_space:o,score:p,ques_type:u,messages:f}})).then(e=>{y.open({type:"success",content:"save success"})}).catch(e=>{y.open({type:"error",content:"save error"})})},children:(0,a.jsxs)(e_.Z,{container:!0,spacing:.5,columns:13,sx:{flexGrow:1},children:[(0,a.jsx)(e_.Z,{xs:3,children:(0,a.jsx)(k,{children:c("Q_A_Category")})}),(0,a.jsx)(e_.Z,{xs:10,children:(0,a.jsx)(ey.Z,{action:g,value:u,placeholder:"Choose one…",onChange:(e,t)=>m(null!=t?t:""),...u&&{endDecorator:(0,a.jsx)(w.ZP,{size:"sm",variant:"plain",color:"neutral",onMouseDown:e=>{e.stopPropagation()},onClick:()=>{var e;m(""),null===(e=g.current)||void 0===e||e.focusVisible()},children:(0,a.jsx)(ep.Z,{})}),indicator:null},sx:{width:"100%"},children:i&&(null===(t=Object.keys(i))||void 0===t?void 0:t.map(e=>(0,a.jsx)(eZ.Z,{value:e,children:i[e]},e)))})}),(0,a.jsx)(e_.Z,{xs:3,children:(0,a.jsx)(k,{children:(0,a.jsx)(_.Z,{title:(0,a.jsx)(eb.Z,{children:(0,a.jsx)("div",{children:c("feed_back_desc")})}),variant:"solid",placement:"left",children:c("Q_A_Rating")})})}),(0,a.jsx)(e_.Z,{xs:10,sx:{pl:0,ml:0},children:(0,a.jsx)(eN.Z,{"aria-label":"Custom",step:1,min:0,max:5,valueLabelFormat:function(e){return({0:c("Lowest"),1:c("Missed"),2:c("Lost"),3:c("Incorrect"),4:c("Verbose"),5:c("Best")})[e]},valueLabelDisplay:"on",marks:[{value:0,label:"0"},{value:1,label:"1"},{value:2,label:"2"},{value:3,label:"3"},{value:4,label:"4"},{value:5,label:"5"}],sx:{width:"90%",pt:3,m:2,ml:1},onChange:e=>{var t;return h(null===(t=e.target)||void 0===t?void 0:t.value)},value:p})}),(0,a.jsx)(e_.Z,{xs:13,children:(0,a.jsx)(ek.Z,{placeholder:c("Please_input_the_text"),value:f,onChange:e=>v(e.target.value),minRows:2,maxRows:4,endDecorator:(0,a.jsx)(eC.ZP,{level:"body-xs",sx:{ml:"auto"},children:c("input_count")+f.length+c("input_unit")}),sx:{width:"100%",fontSize:14}})}),(0,a.jsx)(e_.Z,{xs:13,children:(0,a.jsx)(j.Z,{type:"submit",variant:"outlined",sx:{width:"100%",height:"100%"},children:c("submit")})})]})})})]})]})},eS=l(22672),eR=e=>{var t,l;let{messages:r,onSubmit:c}=e,{dbParam:m,currentDialogue:h,scene:Z,model:P,refreshDialogList:S,chatId:R,agent:E,docId:I}=(0,x.useContext)(s.p),{t:D}=(0,C.$G)(),M=(0,u.useSearchParams)(),F=null!==(t=M&&M.get("select_param"))&&void 0!==t?t:"",L=null!==(l=M&&M.get("spaceNameOriginal"))&&void 0!==l?l:"",[O,z]=(0,x.useState)(!1),[A,V]=(0,x.useState)(!1),[$,G]=(0,x.useState)(r),[U,q]=(0,x.useState)(""),[H,J]=(0,x.useState)(),T=(0,x.useRef)(null),B=(0,x.useMemo)(()=>"chat_dashboard"===Z,[Z]),K=f(),W=(0,x.useMemo)(()=>{switch(Z){case"chat_agent":return E;case"chat_excel":return null==h?void 0:h.select_param;case"chat_flow":return F;default:return L||m}},[Z,E,h,m,L,F]),X=async e=>{if(!O&&e.trim()){if("chat_agent"===Z&&!E){b.ZP.warning(D("choice_agent_tip"));return}try{z(!0),await c(e,{select_param:null!=W?W:""})}finally{z(!1)}}},ee=e=>{try{return JSON.parse(e)}catch(t){return e}},[et,el]=b.ZP.useMessage(),ea=async e=>{let t=null==e?void 0:e.replace(/\trelations:.*/g,""),l=N()(t);l?t?et.open({type:"success",content:D("copy_success")}):et.open({type:"warning",content:D("copy_nothing")}):et.open({type:"error",content:D("copy_failed")})},es=async()=>{!O&&I&&(z(!0),await K(I),z(!1))};return(0,i.Z)(async()=>{let e=(0,o.a_)();e&&e.id===R&&(await X(e.message),S(),localStorage.removeItem(o.rU))},[R]),(0,x.useEffect)(()=>{let e=r;B&&(e=(0,k.cloneDeep)(r).map(e=>((null==e?void 0:e.role)==="view"&&"string"==typeof(null==e?void 0:e.context)&&(e.context=ee(null==e?void 0:e.context)),e))),G(e.filter(e=>["view","human"].includes(e.role)))},[B,r]),(0,x.useEffect)(()=>{(0,n.Vx)((0,n.Lu)()).then(e=>{var t;J(null!==(t=e[1])&&void 0!==t?t:{})}).catch(e=>{console.log(e)})},[]),(0,x.useEffect)(()=>{setTimeout(()=>{var e;null===(e=T.current)||void 0===e||e.scrollTo(0,T.current.scrollHeight)},50)},[r]),(0,a.jsxs)(a.Fragment,{children:[el,(0,a.jsx)("div",{ref:T,className:"flex flex-1 overflow-y-auto pb-8 w-full flex-col",children:(0,a.jsx)("div",{className:"flex items-center flex-1 flex-col text-sm leading-6 text-slate-900 dark:text-slate-300 sm:text-base sm:leading-7",children:$.length?$.map((e,t)=>{var l;return"chat_agent"===Z?(0,a.jsx)(Y,{content:e},t):(0,a.jsx)(ex,{content:e,isChartChat:B,onLinkClick:()=>{V(!0),q(JSON.stringify(null==e?void 0:e.context,null,2))},children:"view"===e.role&&(0,a.jsxs)("div",{className:"flex w-full border-t border-gray-200 dark:border-theme-dark",children:["chat_knowledge"===Z&&e.retry?(0,a.jsxs)(j.Z,{onClick:es,slots:{root:w.ZP},slotProps:{root:{variant:"plain",color:"primary"}},children:[(0,a.jsx)(v.Z,{}),"\xa0",(0,a.jsx)("span",{className:"text-sm",children:D("Retry")})]}):null,(0,a.jsxs)("div",{className:"flex w-full flex-row-reverse",children:[(0,a.jsx)(eP,{select_param:H,conv_index:Math.ceil((t+1)/2),question:null===(l=null==$?void 0:$.filter(t=>(null==t?void 0:t.role)==="human"&&(null==t?void 0:t.order)===e.order)[0])||void 0===l?void 0:l.context,knowledge_space:L||m||""}),(0,a.jsx)(_.Z,{title:D("Copy_Btn"),children:(0,a.jsx)(j.Z,{onClick:()=>ea(null==e?void 0:e.context),slots:{root:w.ZP},slotProps:{root:{variant:"plain",color:"primary"}},sx:{borderRadius:40},children:(0,a.jsx)(g.Z,{})})})]})]})},t)}):(0,a.jsx)(p.Z,{description:"Start a conversation"})})}),(0,a.jsx)("div",{className:d()("relative after:absolute after:-top-8 after:h-8 after:w-full after:bg-gradient-to-t after:from-theme-light after:to-transparent dark:after:from-theme-dark",{"cursor-not-allowed":"chat_excel"===Z&&!(null==h?void 0:h.select_param)}),children:(0,a.jsxs)("div",{className:"flex flex-wrap w-full py-2 sm:pt-6 sm:pb-10 items-center",children:[P&&(0,a.jsx)("div",{className:"mr-2 flex",children:(0,ec.A)(P)}),(0,a.jsx)(Q,{loading:O,onSubmit:X,handleFinish:z})]})}),(0,a.jsx)(y.default,{title:"JSON Editor",open:A,width:"60%",cancelButtonProps:{hidden:!0},onOk:()=>{V(!1)},onCancel:()=>{V(!1)},children:(0,a.jsx)(eS.Z,{className:"w-full h-[500px]",language:"json",value:U})})]})},eE=l(53047),eI=()=>{var e;let t=(0,u.useSearchParams)(),{scene:l,chatId:c,model:f,agent:v,setModel:g,history:j,setHistory:w}=(0,x.useContext)(s.p),{chat:b}=(0,r.Z)({}),_=null!==(e=t&&t.get("initMessage"))&&void 0!==e?e:"",[y,Z]=(0,x.useState)(!1),[N,k]=(0,x.useState)(),C=async()=>{Z(!0);let[,e]=await (0,n.Vx)((0,n.$i)(c));w(null!=e?e:[]),Z(!1)},P=e=>{var t;let l=null===(t=e[e.length-1])||void 0===t?void 0:t.context;if(l)try{let e="string"==typeof l?JSON.parse(l):l;k((null==e?void 0:e.template_name)==="report"?null==e?void 0:e.charts:void 0)}catch(e){console.log(e),k([])}};(0,i.Z)(async()=>{let e=(0,o.a_)();e&&e.id===c||await C()},[_,c]),(0,x.useEffect)(()=>{var e,t;if(!j.length)return;let l=null===(e=null===(t=j.filter(e=>"view"===e.role))||void 0===t?void 0:t.slice(-1))||void 0===e?void 0:e[0];(null==l?void 0:l.model_name)&&g(l.model_name),P(j)},[j.length]),(0,x.useEffect)(()=>()=>{w([])},[]);let S=(0,x.useCallback)((e,t)=>new Promise(a=>{let s=[...j,{role:"human",context:e,model_name:f,order:0,time_stamp:0},{role:"view",context:"",model_name:f,order:0,time_stamp:0}],n=s.length-1;w([...s]),b({data:{...t,chat_mode:l||"chat_normal",model_name:f,user_input:e},chatId:c,onMessage:e=>{(null==t?void 0:t.incremental)?s[n].context+=e:s[n].context=e,w([...s])},onDone:()=>{P(s),a()},onClose:()=>{P(s),a()},onError:e=>{s[n].context=e,w([...s]),a()}})}),[j,b,c,f,v,l]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(h.Z,{visible:y}),(0,a.jsx)(eE.Z,{refreshHistory:C,modelChange:e=>{g(e)}}),(0,a.jsxs)("div",{className:"px-4 flex flex-1 flex-wrap overflow-hidden relative",children:[!!(null==N?void 0:N.length)&&(0,a.jsx)("div",{className:"w-full pb-4 xl:w-3/4 h-1/2 xl:pr-4 xl:h-full overflow-y-auto",children:(0,a.jsx)(m.ZP,{chartsData:N})}),!(null==N?void 0:N.length)&&"chat_dashboard"===l&&(0,a.jsx)(p.Z,{className:"w-full xl:w-3/4 h-1/2 xl:h-full"}),(0,a.jsx)("div",{className:d()("flex flex-1 flex-col overflow-hidden",{"px-0 xl:pl-4 h-1/2 w-full xl:w-auto xl:h-full border-t xl:border-t-0 xl:border-l dark:border-gray-800":"chat_dashboard"===l,"h-full lg:px-8":"chat_dashboard"!==l}),children:(0,a.jsx)(eR,{messages:j,onSubmit:S})})]})]})}},18458:function(e,t,l){var a=l(96469),s=l(53375);t.Z=function(e){let{visible:t}=e;return t?(0,a.jsx)("div",{className:"absolute w-full h-full top-0 left-0 flex justify-center items-center z-10 bg-white dark:bg-black bg-opacity-50 dark:bg-opacity-50 backdrop-blur-sm text-3xl animate-fade animate-duration-200",children:(0,a.jsx)(s.Z,{})}):null}},51310:function(e,t,l){var a=l(88506);t.Z=()=>{var e;return JSON.parse(null!==(e=localStorage.getItem(a.C9))&&void 0!==e?e:"")}}}]);