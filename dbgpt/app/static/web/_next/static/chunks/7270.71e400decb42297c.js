"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7270],{67153:function(e,t,l){l.d(t,{Z:function(){return c}});var a=l(34548),r=l(38497),n={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M885.9 490.3c3.6-12 5.4-24.4 5.4-37 0-28.3-9.3-55.5-26.1-77.7 3.6-12 5.4-24.4 5.4-37 0-28.3-9.3-55.5-26.1-77.7 3.6-12 5.4-24.4 5.4-37 0-51.6-30.7-98.1-78.3-118.4a66.1 66.1 0 00-26.5-5.4H144c-17.7 0-32 14.3-32 32v364c0 17.7 14.3 32 32 32h129.3l85.8 310.8C372.9 889 418.9 924 470.9 924c29.7 0 57.4-11.8 77.9-33.4 20.5-21.5 31-49.7 29.5-79.4l-6-122.9h239.9c12.1 0 23.9-3.2 34.3-9.3 40.4-23.5 65.5-66.1 65.5-111 0-28.3-9.3-55.5-26.1-77.7zM184 456V172h81v284h-81zm627.2 160.4H496.8l9.6 198.4c.6 11.9-4.7 23.1-14.6 30.5-6.1 4.5-13.6 6.8-21.1 6.7a44.28 44.28 0 01-42.2-32.3L329 459.2V172h415.4a56.85 56.85 0 0133.6 51.8c0 9.7-2.3 18.9-6.9 27.3l-13.9 25.4 21.9 19a56.76 56.76 0 0119.6 43c0 9.7-2.3 18.9-6.9 27.3l-13.9 25.4 21.9 19a56.76 56.76 0 0119.6 43c0 9.7-2.3 18.9-6.9 27.3l-14 25.5 21.9 19a56.76 56.76 0 0119.6 43c0 19.1-11 37.5-28.8 48.4z"}}]},name:"dislike",theme:"outlined"},s=l(66956),c=r.forwardRef(function(e,t){return r.createElement(s.Z,(0,a.Z)({},e,{ref:t,icon:n}))})},82857:function(e,t,l){l.d(t,{Z:function(){return c}});var a=l(34548),r=l(38497),n={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M885.9 533.7c16.8-22.2 26.1-49.4 26.1-77.7 0-44.9-25.1-87.4-65.5-111.1a67.67 67.67 0 00-34.3-9.3H572.4l6-122.9c1.4-29.7-9.1-57.9-29.5-79.4A106.62 106.62 0 00471 99.9c-52 0-98 35-111.8 85.1l-85.9 311H144c-17.7 0-32 14.3-32 32v364c0 17.7 14.3 32 32 32h601.3c9.2 0 18.2-1.8 26.5-5.4 47.6-20.3 78.3-66.8 78.3-118.4 0-12.6-1.8-25-5.4-37 16.8-22.2 26.1-49.4 26.1-77.7 0-12.6-1.8-25-5.4-37 16.8-22.2 26.1-49.4 26.1-77.7-.2-12.6-2-25.1-5.6-37.1zM184 852V568h81v284h-81zm636.4-353l-21.9 19 13.9 25.4a56.2 56.2 0 016.9 27.3c0 16.5-7.2 32.2-19.6 43l-21.9 19 13.9 25.4a56.2 56.2 0 016.9 27.3c0 16.5-7.2 32.2-19.6 43l-21.9 19 13.9 25.4a56.2 56.2 0 016.9 27.3c0 22.4-13.2 42.6-33.6 51.8H329V564.8l99.5-360.5a44.1 44.1 0 0142.2-32.3c7.6 0 15.1 2.2 21.1 6.7 9.9 7.4 15.2 18.6 14.6 30.5l-9.6 198.4h314.4C829 418.5 840 436.9 840 456c0 16.5-7.2 32.1-19.6 43z"}}]},name:"like",theme:"outlined"},s=l(66956),c=r.forwardRef(function(e,t){return r.createElement(s.Z,(0,a.Z)({},e,{ref:t,icon:n}))})},40144:function(e,t,l){var a=l(69336),r=l(38497),n=l(90232);t.Z=function(e,t){(0,r.useEffect)(function(){var t=e(),l=!1;return!function(){(0,a.mG)(this,void 0,void 0,function(){return(0,a.Jh)(this,function(e){switch(e.label){case 0:if(!(0,n.mf)(t[Symbol.asyncIterator]))return[3,4];e.label=1;case 1:return[4,t.next()];case 2:if(e.sent().done||l)return[3,3];return[3,1];case 3:return[3,6];case 4:return[4,t];case 5:e.sent(),e.label=6;case 6:return[2]}})})}(),function(){l=!0}},t)}},48218:function(e,t,l){l.d(t,{Z:function(){return C}});var a=l(38497),r=l(26869),n=l.n(r),s=l(61060),c=l(93226),i=l(13785),o=l(12719),u=l(54534);let f=["wrap","nowrap","wrap-reverse"],d=["flex-start","flex-end","start","end","center","space-between","space-around","space-evenly","stretch","normal","left","right"],p=["center","start","end","flex-start","flex-end","self-start","self-end","baseline","normal","stretch"],x=(e,t)=>{let l=!0===t.wrap?"wrap":t.wrap;return{[`${e}-wrap-${l}`]:l&&f.includes(l)}},m=(e,t)=>{let l={};return p.forEach(a=>{l[`${e}-align-${a}`]=t.align===a}),l[`${e}-align-stretch`]=!t.align&&!!t.vertical,l},g=(e,t)=>{let l={};return d.forEach(a=>{l[`${e}-justify-${a}`]=t.justify===a}),l},h=e=>{let{componentCls:t}=e;return{[t]:{display:"flex",margin:0,padding:0,"&-vertical":{flexDirection:"column"},"&-rtl":{direction:"rtl"},"&:empty":{display:"none"}}}},y=e=>{let{componentCls:t}=e;return{[t]:{"&-gap-small":{gap:e.flexGapSM},"&-gap-middle":{gap:e.flexGap},"&-gap-large":{gap:e.flexGapLG}}}},v=e=>{let{componentCls:t}=e,l={};return f.forEach(e=>{l[`${t}-wrap-${e}`]={flexWrap:e}}),l},b=e=>{let{componentCls:t}=e,l={};return p.forEach(e=>{l[`${t}-align-${e}`]={alignItems:e}}),l},j=e=>{let{componentCls:t}=e,l={};return d.forEach(e=>{l[`${t}-justify-${e}`]={justifyContent:e}}),l};var w=(0,o.I$)("Flex",e=>{let{paddingXS:t,padding:l,paddingLG:a}=e,r=(0,u.IX)(e,{flexGapSM:t,flexGap:l,flexGapLG:a});return[h(r),y(r),v(r),b(r),j(r)]},()=>({}),{resetStyle:!1}),$=function(e,t){var l={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&0>t.indexOf(a)&&(l[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,a=Object.getOwnPropertySymbols(e);r<a.length;r++)0>t.indexOf(a[r])&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(l[a[r]]=e[a[r]]);return l};let O=a.forwardRef((e,t)=>{let{prefixCls:l,rootClassName:r,className:o,style:u,flex:f,gap:d,children:p,vertical:h=!1,component:y="div"}=e,v=$(e,["prefixCls","rootClassName","className","style","flex","gap","children","vertical","component"]),{flex:b,direction:j,getPrefixCls:O}=a.useContext(i.E_),C=O("flex",l),[N,k,Z]=w(C),_=null!=h?h:null==b?void 0:b.vertical,E=n()(o,r,null==b?void 0:b.className,C,k,Z,n()(Object.assign(Object.assign(Object.assign({},x(C,e)),m(C,e)),g(C,e))),{[`${C}-rtl`]:"rtl"===j,[`${C}-gap-${d}`]:(0,c.n)(d),[`${C}-vertical`]:_}),S=Object.assign(Object.assign({},null==b?void 0:b.style),u);return f&&(S.flex=f),d&&!(0,c.n)(d)&&(S.gap=d),N(a.createElement(y,Object.assign({ref:t,className:E,style:S},(0,s.Z)(v,["justify","wrap","align"])),p))});var C=O},28088:function(e,t,l){var a=l(38497);let r=(0,a.createContext)({});t.Z=r},25583:function(e,t,l){var a=l(38497),r=l(26869),n=l.n(r),s=l(13785),c=l(28088),i=l(67054),o=function(e,t){var l={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&0>t.indexOf(a)&&(l[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,a=Object.getOwnPropertySymbols(e);r<a.length;r++)0>t.indexOf(a[r])&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(l[a[r]]=e[a[r]]);return l};function u(e){return"number"==typeof e?`${e} ${e} auto`:/^\d+(\.\d+)?(px|em|rem|%)$/.test(e)?`0 0 ${e}`:e}let f=["xs","sm","md","lg","xl","xxl"],d=a.forwardRef((e,t)=>{let{getPrefixCls:l,direction:r}=a.useContext(s.E_),{gutter:d,wrap:p}=a.useContext(c.Z),{prefixCls:x,span:m,order:g,offset:h,push:y,pull:v,className:b,children:j,flex:w,style:$}=e,O=o(e,["prefixCls","span","order","offset","push","pull","className","children","flex","style"]),C=l("col",x),[N,k,Z]=(0,i.cG)(C),_={},E={};f.forEach(t=>{let l={},a=e[t];"number"==typeof a?l.span=a:"object"==typeof a&&(l=a||{}),delete O[t],E=Object.assign(Object.assign({},E),{[`${C}-${t}-${l.span}`]:void 0!==l.span,[`${C}-${t}-order-${l.order}`]:l.order||0===l.order,[`${C}-${t}-offset-${l.offset}`]:l.offset||0===l.offset,[`${C}-${t}-push-${l.push}`]:l.push||0===l.push,[`${C}-${t}-pull-${l.pull}`]:l.pull||0===l.pull,[`${C}-rtl`]:"rtl"===r}),l.flex&&(E[`${C}-${t}-flex`]=!0,_[`--${C}-${t}-flex`]=u(l.flex))});let S=n()(C,{[`${C}-${m}`]:void 0!==m,[`${C}-order-${g}`]:g,[`${C}-offset-${h}`]:h,[`${C}-push-${y}`]:y,[`${C}-pull-${v}`]:v},b,E,k,Z),P={};if(d&&d[0]>0){let e=d[0]/2;P.paddingLeft=e,P.paddingRight=e}return w&&(P.flex=u(w),!1!==p||P.minWidth||(P.minWidth=0)),N(a.createElement("div",Object.assign({},O,{style:Object.assign(Object.assign(Object.assign({},P),$),_),className:S,ref:t}),j))});t.Z=d},12087:function(e,t,l){var a=l(38497),r=l(26869),n=l.n(r),s=l(99937),c=l(13785),i=l(28088),o=l(67054),u=function(e,t){var l={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&0>t.indexOf(a)&&(l[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,a=Object.getOwnPropertySymbols(e);r<a.length;r++)0>t.indexOf(a[r])&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(l[a[r]]=e[a[r]]);return l};function f(e,t){let[l,r]=a.useState("string"==typeof e?e:""),n=()=>{if("string"==typeof e&&r(e),"object"==typeof e)for(let l=0;l<s.c4.length;l++){let a=s.c4[l];if(!t[a])continue;let n=e[a];if(void 0!==n){r(n);return}}};return a.useEffect(()=>{n()},[JSON.stringify(e),t]),l}let d=a.forwardRef((e,t)=>{let{prefixCls:l,justify:r,align:d,className:p,style:x,children:m,gutter:g=0,wrap:h}=e,y=u(e,["prefixCls","justify","align","className","style","children","gutter","wrap"]),{getPrefixCls:v,direction:b}=a.useContext(c.E_),[j,w]=a.useState({xs:!0,sm:!0,md:!0,lg:!0,xl:!0,xxl:!0}),[$,O]=a.useState({xs:!1,sm:!1,md:!1,lg:!1,xl:!1,xxl:!1}),C=f(d,$),N=f(r,$),k=a.useRef(g),Z=(0,s.ZP)();a.useEffect(()=>{let e=Z.subscribe(e=>{O(e);let t=k.current||0;(!Array.isArray(t)&&"object"==typeof t||Array.isArray(t)&&("object"==typeof t[0]||"object"==typeof t[1]))&&w(e)});return()=>Z.unsubscribe(e)},[]);let _=v("row",l),[E,S,P]=(0,o.VM)(_),M=(()=>{let e=[void 0,void 0],t=Array.isArray(g)?g:[g,void 0];return t.forEach((t,l)=>{if("object"==typeof t)for(let a=0;a<s.c4.length;a++){let r=s.c4[a];if(j[r]&&void 0!==t[r]){e[l]=t[r];break}}else e[l]=t}),e})(),A=n()(_,{[`${_}-no-wrap`]:!1===h,[`${_}-${N}`]:N,[`${_}-${C}`]:C,[`${_}-rtl`]:"rtl"===b},p,S,P),G={},I=null!=M[0]&&M[0]>0?-(M[0]/2):void 0;I&&(G.marginLeft=I,G.marginRight=I);let[R,z]=M;G.rowGap=z;let V=a.useMemo(()=>({gutter:[R,z],wrap:h}),[R,z,h]);return E(a.createElement(i.Z.Provider,{value:V},a.createElement("div",Object.assign({},y,{className:A,style:Object.assign(Object.assign({},G),x),ref:t}),m)))});t.Z=d},574:function(e,t,l){l.r(t);var a=l(96469),r=l(61977),n=l(26657),s=l(78692),c=l(26869),i=l.n(c),o=l(38497),u=l(29549),f=l(93597);t.default=(0,o.memo)(e=>{let{message:t,index:l}=e,{scene:c}=(0,o.useContext)(u.MobileChatContext),{context:d,model_name:p,role:x,thinking:m}=t,g=(0,o.useMemo)(()=>"view"===x,[x]),h=(0,o.useRef)(null),{value:y}=(0,o.useMemo)(()=>{if("string"!=typeof d)return{relations:[],value:"",cachePluginContext:[]};let[e,t]=d.split("	relations:"),l=t?t.split(","):[],a=[],r=0,n=e.replace(/<dbgpt-view[^>]*>[^<]*<\/dbgpt-view>/gi,e=>{try{var t;let l=e.replaceAll("\n","\\n").replace(/<[^>]*>|<\/[^>]*>/gm,""),n=JSON.parse(l),s="<custom-view>".concat(r,"</custom-view>");return a.push({...n,result:v(null!==(t=n.result)&&void 0!==t?t:"")}),r++,s}catch(t){return console.log(t.message,t),e}});return{relations:l,cachePluginContext:a,value:n}},[d]),v=e=>e.replaceAll("\\n","\n").replace(/<table(\w*=[^>]+)>/gi,"<table $1>").replace(/<tr(\w*=[^>]+)>/gi,"<tr $1>");return(0,a.jsxs)("div",{className:i()("flex w-full",{"justify-end":!g}),ref:h,children:[!g&&(0,a.jsx)("div",{className:"flex bg-[#0C75FC]  text-white p-3 rounded-xl rounded-br-none",children:d}),g&&(0,a.jsxs)("div",{className:"flex max-w-full flex-col flex-wrap bg-white dark:bg-[rgba(255,255,255,0.16)] p-3 rounded-xl rounded-bl-none",children:["string"==typeof d&&"chat_agent"===c&&(0,a.jsx)(n.default,{children:null==y?void 0:y.replace(/<table(\w*=[^>]+)>/gi,"<table $1>").replace(/<tr(\w*=[^>]+)>/gi,"<tr $1>")}),"string"==typeof d&&"chat_agent"!==c&&(0,a.jsx)(n.default,{children:v(y)}),m&&!d&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"flex text-sm text-[#1c2533] dark:text-white",children:"思考中"}),(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("div",{className:"w-1 h-1 rounded-full mx-1 animate-pulse1"}),(0,a.jsx)("div",{className:"w-1 h-1 rounded-full mx-1 animate-pulse2"}),(0,a.jsx)("div",{className:"w-1 h-1 rounded-full mx-1 animate-pulse3"})]})]}),!m&&(0,a.jsx)(s.Z,{className:"my-2"}),(0,a.jsxs)("div",{className:i()("opacity-0 h-0 w-0",{"opacity-100 flex items-center justify-between gap-6 w-auto h-auto":!m}),children:[(0,a.jsx)(f.default,{content:t,index:l,chatDialogRef:h}),"chat_agent"!==c&&(0,a.jsxs)("div",{className:"flex gap-1 items-center",children:[(0,a.jsx)(r.Z,{width:14,height:14,model:p}),(0,a.jsx)("span",{className:"text-xs text-gray-500",children:p})]})]})]})]})})},33068:function(e,t,l){l.r(t);var a=l(96469),r=l(38497),n=l(29549),s=l(574);t.default=(0,r.memo)(()=>{let{history:e}=(0,r.useContext)(n.MobileChatContext),t=(0,r.useMemo)(()=>e.filter(e=>["view","human"].includes(e.role)),[e]);return(0,a.jsx)("div",{className:"flex flex-col gap-4",children:!!t.length&&t.map((e,t)=>(0,a.jsx)(s.default,{message:e,index:t},e.context+t))})})},39452:function(e,t,l){l.r(t);var a=l(96469),r=l(37352),n=l(86250),s=l(6319),c=l(75148),i=l(38497);t.default=e=>{let{open:t,setFeedbackOpen:l,list:o,feedback:u,loading:f}=e,[d,p]=(0,i.useState)([]),[x,m]=(0,i.useState)("");return(0,a.jsx)(r.Z,{title:"你的反馈助我进步",placement:"bottom",open:t,onClose:()=>l(!1),destroyOnClose:!0,height:"auto",children:(0,a.jsxs)("div",{className:"flex flex-col w-full gap-4",children:[(0,a.jsx)("div",{className:"flex w-full flex-wrap gap-2",children:null==o?void 0:o.map(e=>{let t=d.findIndex(t=>t.reason_type===e.reason_type)>-1;return(0,a.jsx)(n.Z,{className:"text-sm text-[#525964] p-1 px-2 rounded-md cursor-pointer ".concat(t?"border-[#0c75fc] text-[#0c75fc]":""),onClick:()=>{p(t=>{let l=t.findIndex(t=>t.reason_type===e.reason_type);return l>-1?[...t.slice(0,l),...t.slice(l+1)]:[...t,e]})},children:e.reason},e.reason_type)})}),(0,a.jsx)(s.default.TextArea,{placeholder:"描述一下具体问题或更优的答案",className:"h-24 resize-none mb-2",value:x,onChange:e=>m(e.target.value.trim())}),(0,a.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,a.jsx)(c.ZP,{className:"w-16 h-8",onClick:()=>{l(!1)},children:"取消"}),(0,a.jsx)(c.ZP,{type:"primary",className:"min-w-16 h-8",onClick:async()=>{let e=d.map(e=>e.reason_type);await (null==u?void 0:u({feedback_type:"unlike",reason_types:e,remark:x}))},loading:f,children:"确认"})]})]})})}},93597:function(e,t,l){l.r(t);var a=l(96469),r=l(40789),n=l(82857),s=l(67153),c=l(40371),i=l(95838),o=l(23712),u=l(78692),f=l(75148),d=l(26869),p=l.n(d),x=l(93486),m=l.n(x),g=l(38497),h=l(29549),y=l(39452);t.default=e=>{var t;let{content:l,index:d,chatDialogRef:x}=e,{conv_uid:v,history:b,scene:j}=(0,g.useContext)(h.MobileChatContext),{message:w}=o.Z.useApp(),[$,O]=(0,g.useState)(!1),[C,N]=(0,g.useState)(null==l?void 0:null===(t=l.feedback)||void 0===t?void 0:t.feedback_type),[k,Z]=(0,g.useState)([]),_=async e=>{var t;let l=null==e?void 0:e.replace(/\trelations:.*/g,""),a=m()((null===(t=x.current)||void 0===t?void 0:t.textContent)||l);a?l?w.success("复制成功"):w.warning("内容复制为空"):w.error("复制失败")},{run:E,loading:S}=(0,i.Z)(async e=>await (0,r.Vx)((0,r.zx)({conv_uid:v,message_id:l.order+"",feedback_type:e.feedback_type,reason_types:e.reason_types,remark:e.remark})),{manual:!0,onSuccess:e=>{let[,t]=e;N(null==t?void 0:t.feedback_type),w.success("反馈成功"),O(!1)}}),{run:P}=(0,i.Z)(async()=>await (0,r.Vx)((0,r.Ir)({conv_uid:v,message_id:(null==l?void 0:l.order)+""})),{manual:!0,onSuccess:e=>{let[,t]=e;t&&(N("none"),w.success("操作成功"))}}),{run:M}=(0,i.Z)(async()=>await (0,r.Vx)((0,r.Jr)()),{manual:!0,onSuccess:e=>{let[,t]=e;Z(t||[]),t&&O(!0)}}),{run:A,loading:G}=(0,i.Z)(async()=>await (0,r.Vx)((0,r.Ty)({conv_id:v,round_index:0})),{manual:!0,onSuccess:()=>{w.success("操作成功")}});return(0,a.jsxs)("div",{className:"flex items-center text-sm",children:[(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)(n.Z,{className:p()("cursor-pointer",{"text-[#0C75FC]":"like"===C}),onClick:async()=>{if("like"===C){await P();return}await E({feedback_type:"like"})}}),(0,a.jsx)(s.Z,{className:p()("cursor-pointer",{"text-[#0C75FC]":"unlike"===C}),onClick:async()=>{if("unlike"===C){await P();return}await M()}}),(0,a.jsx)(y.default,{open:$,setFeedbackOpen:O,list:k,feedback:E,loading:S})]}),(0,a.jsx)(u.Z,{type:"vertical"}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(c.Z,{className:"cursor-pointer",onClick:()=>_(l.context)}),b.length-1===d&&"chat_agent"===j&&(0,a.jsx)(f.ZP,{loading:G,size:"small",onClick:async()=>{await A()},className:"text-xs",children:"终止话题"})]})]})}}}]);