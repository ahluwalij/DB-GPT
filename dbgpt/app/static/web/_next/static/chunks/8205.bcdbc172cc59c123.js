"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8205],{66634:function(e,t,l){l.d(t,{Z:function(){return s}});var n=l(34548),a=l(38497),i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M893.3 293.3L730.7 130.7c-12-12-28.3-18.7-45.3-18.7H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V338.5c0-17-6.7-33.2-18.7-45.2zM384 176h256v112H384V176zm128 554c-79.5 0-144-64.5-144-144s64.5-144 144-144 144 64.5 144 144-64.5 144-144 144zm0-224c-44.2 0-80 35.8-80 80s35.8 80 80 80 80-35.8 80-80-35.8-80-80-80z"}}]},name:"save",theme:"filled"},r=l(66956),s=a.forwardRef(function(e,t){return a.createElement(r.Z,(0,n.Z)({},e,{ref:t,icon:i}))})},28088:function(e,t,l){var n=l(38497);let a=(0,n.createContext)({});t.Z=a},25583:function(e,t,l){var n=l(38497),a=l(26869),i=l.n(a),r=l(13785),s=l(28088),o=l(67054),d=function(e,t){var l={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&0>t.indexOf(n)&&(l[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var a=0,n=Object.getOwnPropertySymbols(e);a<n.length;a++)0>t.indexOf(n[a])&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(l[n[a]]=e[n[a]]);return l};function c(e){return"number"==typeof e?`${e} ${e} auto`:/^\d+(\.\d+)?(px|em|rem|%)$/.test(e)?`0 0 ${e}`:e}let u=["xs","sm","md","lg","xl","xxl"],h=n.forwardRef((e,t)=>{let{getPrefixCls:l,direction:a}=n.useContext(r.E_),{gutter:h,wrap:v}=n.useContext(s.Z),{prefixCls:m,span:f,order:p,offset:x,push:y,pull:g,className:j,children:_,flex:w,style:b}=e,N=d(e,["prefixCls","span","order","offset","push","pull","className","children","flex","style"]),C=l("col",m),[k,Z,O]=(0,o.cG)(C),S={},E={};u.forEach(t=>{let l={},n=e[t];"number"==typeof n?l.span=n:"object"==typeof n&&(l=n||{}),delete N[t],E=Object.assign(Object.assign({},E),{[`${C}-${t}-${l.span}`]:void 0!==l.span,[`${C}-${t}-order-${l.order}`]:l.order||0===l.order,[`${C}-${t}-offset-${l.offset}`]:l.offset||0===l.offset,[`${C}-${t}-push-${l.push}`]:l.push||0===l.push,[`${C}-${t}-pull-${l.pull}`]:l.pull||0===l.pull,[`${C}-rtl`]:"rtl"===a}),l.flex&&(E[`${C}-${t}-flex`]=!0,S[`--${C}-${t}-flex`]=c(l.flex))});let $=i()(C,{[`${C}-${f}`]:void 0!==f,[`${C}-order-${p}`]:p,[`${C}-offset-${x}`]:x,[`${C}-push-${y}`]:y,[`${C}-pull-${g}`]:g},j,E,Z,O),M={};if(h&&h[0]>0){let e=h[0]/2;M.paddingLeft=e,M.paddingRight=e}return w&&(M.flex=c(w),!1!==v||M.minWidth||(M.minWidth=0)),k(n.createElement("div",Object.assign({},N,{style:Object.assign(Object.assign(Object.assign({},M),b),S),className:$,ref:t}),_))});t.Z=h},12087:function(e,t,l){var n=l(38497),a=l(26869),i=l.n(a),r=l(99937),s=l(13785),o=l(28088),d=l(67054),c=function(e,t){var l={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&0>t.indexOf(n)&&(l[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var a=0,n=Object.getOwnPropertySymbols(e);a<n.length;a++)0>t.indexOf(n[a])&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(l[n[a]]=e[n[a]]);return l};function u(e,t){let[l,a]=n.useState("string"==typeof e?e:""),i=()=>{if("string"==typeof e&&a(e),"object"==typeof e)for(let l=0;l<r.c4.length;l++){let n=r.c4[l];if(!t[n])continue;let i=e[n];if(void 0!==i){a(i);return}}};return n.useEffect(()=>{i()},[JSON.stringify(e),t]),l}let h=n.forwardRef((e,t)=>{let{prefixCls:l,justify:a,align:h,className:v,style:m,children:f,gutter:p=0,wrap:x}=e,y=c(e,["prefixCls","justify","align","className","style","children","gutter","wrap"]),{getPrefixCls:g,direction:j}=n.useContext(s.E_),[_,w]=n.useState({xs:!0,sm:!0,md:!0,lg:!0,xl:!0,xxl:!0}),[b,N]=n.useState({xs:!1,sm:!1,md:!1,lg:!1,xl:!1,xxl:!1}),C=u(h,b),k=u(a,b),Z=n.useRef(p),O=(0,r.ZP)();n.useEffect(()=>{let e=O.subscribe(e=>{N(e);let t=Z.current||0;(!Array.isArray(t)&&"object"==typeof t||Array.isArray(t)&&("object"==typeof t[0]||"object"==typeof t[1]))&&w(e)});return()=>O.unsubscribe(e)},[]);let S=g("row",l),[E,$,M]=(0,d.VM)(S),P=(()=>{let e=[void 0,void 0],t=Array.isArray(p)?p:[p,void 0];return t.forEach((t,l)=>{if("object"==typeof t)for(let n=0;n<r.c4.length;n++){let a=r.c4[n];if(_[a]&&void 0!==t[a]){e[l]=t[a];break}}else e[l]=t}),e})(),z=i()(S,{[`${S}-no-wrap`]:!1===x,[`${S}-${k}`]:k,[`${S}-${C}`]:C,[`${S}-rtl`]:"rtl"===j},v,$,M),T={},R=null!=P[0]&&P[0]>0?-(P[0]/2):void 0;R&&(T.marginLeft=R,T.marginRight=R);let[D,q]=P;T.rowGap=q;let A=n.useMemo(()=>({gutter:[D,q],wrap:x}),[D,q,x]);return E(n.createElement(o.Z.Provider,{value:A},n.createElement("div",Object.assign({},y,{className:z,style:Object.assign(Object.assign({},T),m),ref:t}),f)))});t.Z=h},93743:function(e,t,l){l.d(t,{_:function(){return T},a:function(){return P}});var n=l(96469),a=l(45277),i=l(42988),r=l(39748),s=l(40511),o=l(51645),d=l(21486),c=l(72249),u=l(98226),h=l(18521),v=l(75148),m=l(68840),f=l(44766),p=l(38497);let x=e=>{if(!e)return;let t=e.getContainer(),l=t.getElementsByTagName("canvas")[0];return l};var y=l(2),g=l(98922);let j=e=>{let{charts:t,scopeOfCharts:l,ruleConfig:n}=e,a={};if(null==t||t.forEach(e=>{if(e.chartKnowledge.toSpec){let t=e.chartKnowledge.toSpec;e.chartKnowledge.toSpec=(e,l)=>({...t(e,l),dataProps:l})}else e.chartKnowledge.toSpec=(e,t)=>({dataProps:t});a[e.chartType]=e.chartKnowledge}),(null==l?void 0:l.exclude)&&l.exclude.forEach(e=>{Object.keys(a).includes(e)&&delete a[e]}),null==l?void 0:l.include){let e=l.include;Object.keys(a).forEach(t=>{e.includes(t)||delete a[t]})}let i={...l,custom:a},r={...n},s=new y.w({ckbCfg:i,ruleCfg:r});return s},_=e=>{var t;let{data:l,dataMetaMap:n,myChartAdvisor:a}=e,i=n?Object.keys(n).map(e=>({name:e,...n[e]})):null,r=new g.Z(l).info(),s=(0,f.size)(r)>2?null==r?void 0:r.filter(e=>"string"!==e.recommendation&&"date"!==e.recommendation||e.distinct&&e.distinct>1):r,o=null==a?void 0:a.adviseWithLog({data:l,dataProps:i,fields:null==s?void 0:s.map(e=>e.name)});return null!==(t=null==o?void 0:o.advices)&&void 0!==t?t:[]};function w(e,t){return t.every(t=>e.includes(t))}function b(e,t){let l=t.find(t=>t.name===e);return(null==l?void 0:l.recommendation)==="date"?t=>new Date(t[e]):e}function N(e){return e.find(e=>{var t;return e.levelOfMeasurements&&(t=e.levelOfMeasurements,["Time","Ordinal"].some(e=>t.includes(e)))})}function C(e){return e.find(e=>e.levelOfMeasurements&&w(e.levelOfMeasurements,["Nominal"]))}let k=e=>{let{data:t,xField:l}=e,n=(0,f.uniq)(t.map(e=>e[l]));return n.length<=1},Z=(e,t,l)=>{let{field4Split:n,field4X:a}=l;if((null==n?void 0:n.name)&&(null==a?void 0:a.name)){let l=e[n.name],i=t.filter(e=>n.name&&e[n.name]===l);return k({data:i,xField:a.name})?5:void 0}return(null==a?void 0:a.name)&&k({data:t,xField:a.name})?5:void 0},O=e=>{let{data:t,chartType:l,xField:n}=e,a=(0,f.cloneDeep)(t);try{if(l.includes("line")&&(null==n?void 0:n.name)&&"date"===n.recommendation)return a.sort((e,t)=>new Date(e[n.name]).getTime()-new Date(t[n.name]).getTime()),a;l.includes("line")&&(null==n?void 0:n.name)&&["float","integer"].includes(n.recommendation)&&a.sort((e,t)=>e[n.name]-t[n.name])}catch(e){console.error(e)}return a},S=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-";return e.map(e=>{let l={};return Object.keys(e).forEach(n=>{l[n]=e[n]===t?null:e[n]}),l})},E="multi_line_chart",$="multi_measure_line_chart",M=[{chartType:"multi_line_chart",chartKnowledge:{id:E,name:"multi_line_chart",alias:["multi_line_chart"],family:["LineCharts"],def:"multi_line_chart uses lines with segments to show changes in data in a ordinal dimension",purpose:["Comparison","Trend"],coord:["Cartesian2D"],category:["Statistic"],shape:["Lines"],dataPres:[{minQty:1,maxQty:1,fieldConditions:["Time","Ordinal"]},{minQty:1,maxQty:"*",fieldConditions:["Interval"]},{minQty:0,maxQty:1,fieldConditions:["Nominal"]}],channel:["Color","Direction","Position"],recRate:"Recommended",toSpec:(e,t)=>{var l,n;let a=N(t),i=C(t),r=null!==(l=null!=a?a:i)&&void 0!==l?l:t[0],s=t.filter(e=>e.name!==(null==r?void 0:r.name)),o=null!==(n=s.filter(e=>e.levelOfMeasurements&&w(e.levelOfMeasurements,["Interval"])))&&void 0!==n?n:[s[0]],d=s.filter(e=>!o.find(t=>t.name===e.name)).find(e=>e.levelOfMeasurements&&w(e.levelOfMeasurements,["Nominal"]));if(!r||!o)return null;let c={type:"view",autoFit:!0,data:O({data:e,chartType:E,xField:r}),children:[]};return o.forEach(l=>{let n={type:"line",encode:{x:b(r.name,t),y:l.name,size:t=>Z(t,e,{field4Split:d,field4X:r})},legend:{size:!1}};d&&(n.encode.color=d.name),c.children.push(n)}),c}},chineseName:"折线图"},{chartType:"multi_measure_column_chart",chartKnowledge:{id:"multi_measure_column_chart",name:"multi_measure_column_chart",alias:["multi_measure_column_chart"],family:["ColumnCharts"],def:"multi_measure_column_chart uses lines with segments to show changes in data in a ordinal dimension",purpose:["Comparison","Distribution"],coord:["Cartesian2D"],category:["Statistic"],shape:["Lines"],dataPres:[{minQty:1,maxQty:"*",fieldConditions:["Interval"]},{minQty:1,maxQty:1,fieldConditions:["Nominal"]}],channel:["Color","Direction","Position"],recRate:"Recommended",toSpec:(e,t)=>{try{let l=null==t?void 0:t.filter(e=>w(e.levelOfMeasurements,["Interval"])),n=C(t),a=N(t),i=null!=n?n:a;if(!i||!l)return null;let r={type:"view",data:e,children:[]};return null==l||l.forEach(e=>{let t={type:"interval",encode:{x:i.name,y:e.name,color:()=>e.name,series:()=>e.name}};r.children.push(t)}),r}catch(e){return console.log(e),null}}},chineseName:"折线图"},{chartType:"multi_measure_line_chart",chartKnowledge:{id:$,name:"multi_measure_line_chart",alias:["multi_measure_line_chart"],family:["LineCharts"],def:"multi_measure_line_chart uses lines with segments to show changes in data in a ordinal dimension",purpose:["Comparison","Distribution"],coord:["Cartesian2D"],category:["Statistic"],shape:["Lines"],dataPres:[{minQty:1,maxQty:"*",fieldConditions:["Interval"]},{minQty:1,maxQty:1,fieldConditions:["Nominal"]}],channel:["Color","Direction","Position"],recRate:"Recommended",toSpec:(e,t)=>{try{var l,n;let a=null!==(n=null!==(l=C(t))&&void 0!==l?l:N(t))&&void 0!==n?n:t[0],i=null==t?void 0:t.filter(e=>e.name!==(null==a?void 0:a.name)&&w(e.levelOfMeasurements,["Interval"]));if(!a||!i)return null;let r={type:"view",data:O({data:e,chartType:$,xField:a}),children:[]};return null==i||i.forEach(l=>{let n={type:"line",encode:{x:b(a.name,t),y:l.name,color:()=>l.name,series:()=>l.name,size:t=>Z(t,e,{field4X:a})},legend:{size:!1}};r.children.push(n)}),r}catch(e){return console.log(e),null}}},chineseName:"折线图"}],P=e=>"response_line_chart"===e?["multi_line_chart","multi_measure_line_chart"]:"response_bar_chart"===e?["multi_measure_column_chart"]:"response_pie_chart"===e?["pie_chart"]:"response_scatter_chart"===e?["scatter_plot"]:"response_area_chart"===e?["area_chart"]:"response_heatmap_chart"===e?["heatmap"]:[],{Option:z}=o.default,T=e=>{let{data:t,chartType:l,scopeOfCharts:y,ruleConfig:g}=e,w=S(t),{mode:b}=(0,p.useContext)(a.p),[N,C]=(0,p.useState)(),[k,Z]=(0,p.useState)([]),[E,$]=(0,p.useState)(),P=(0,p.useRef)();(0,p.useEffect)(()=>{C(j({charts:M,scopeOfCharts:{exclude:["area_chart","stacked_area_chart","percent_stacked_area_chart"]},ruleConfig:g}))},[g,y]);let T=e=>{if(!N)return[];let t=function(e){let{advices:t}=e;return t}({advices:e}),n=(0,f.uniq)((0,f.compact)((0,f.concat)(l,e.map(e=>e.type)))),a=n.map(e=>{let l=t.find(t=>t.type===e);if(l)return l;let n=N.dataAnalyzer.execute({data:w});if("data"in n){var a;let t=N.specGenerator.execute({data:n.data,dataProps:n.dataProps,chartTypeRecommendations:[{chartType:e,score:1}]});if("advices"in t)return null===(a=t.advices)||void 0===a?void 0:a[0]}}).filter(e=>null==e?void 0:e.spec);return a};(0,p.useEffect)(()=>{if(w&&N){var e;let t=_({data:w,myChartAdvisor:N}),l=T(t);Z(l),$(null===(e=l[0])||void 0===e?void 0:e.type)}},[JSON.stringify(w),N,l]);let R=(0,p.useMemo)(()=>{if((null==k?void 0:k.length)>0){var e,t,l,a;let i=null!=E?E:k[0].type,r=null!==(t=null===(e=null==k?void 0:k.find(e=>e.type===i))||void 0===e?void 0:e.spec)&&void 0!==t?t:void 0;if(r){if(r.data&&["line_chart","step_line_chart"].includes(i)){let e=null==N?void 0:N.dataAnalyzer.execute({data:w});e&&"dataProps"in e&&(r.data=O({data:r.data,xField:null===(a=e.dataProps)||void 0===a?void 0:a.find(e=>"date"===e.recommendation),chartType:i}))}return"pie_chart"===i&&(null==r?void 0:null===(l=r.encode)||void 0===l?void 0:l.color)&&(r.tooltip={title:{field:r.encode.color}}),(0,n.jsx)(s.k,{options:{...r,autoFit:!0,theme:b,height:300},ref:P},i)}}},[k,b,E]);return E?(0,n.jsxs)("div",{children:[(0,n.jsxs)(d.Z,{justify:"space-between",className:"mb-2",children:[(0,n.jsx)(c.Z,{children:(0,n.jsxs)(u.Z,{children:[(0,n.jsx)("span",{children:i.Z.t("Advices")}),(0,n.jsx)(o.default,{className:"w-52",value:E,placeholder:"Chart Switcher",onChange:e=>$(e),size:"small",children:null==k?void 0:k.map(e=>{let t=i.Z.t(e.type);return(0,n.jsx)(z,{value:e.type,children:(0,n.jsx)(h.Z,{title:t,placement:"right",children:(0,n.jsx)("div",{children:t})})},e.type)})})]})}),(0,n.jsx)(c.Z,{children:(0,n.jsx)(h.Z,{title:i.Z.t("Download"),children:(0,n.jsx)(v.ZP,{onClick:()=>(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Chart",l=document.createElement("a"),n="".concat(t,".png");setTimeout(()=>{let t=function(e){let t=x(e);if(t){let e=t.toDataURL("image/png");return e}}(e);if(t){l.addEventListener("click",()=>{l.download=n,l.href=t});let e=document.createEvent("MouseEvents");e.initEvent("click",!1,!1),l.dispatchEvent(e)}},16)})(P.current,i.Z.t(E)),icon:(0,n.jsx)(r.Z,{}),type:"text"})})})]}),(0,n.jsx)("div",{className:"flex",children:R})]}):(0,n.jsx)(m.Z,{image:m.Z.PRESENTED_IMAGE_SIMPLE,description:"暂无合适的可视化视图"})}},45045:function(e,t,l){l.d(t,{_z:function(){return f._},ZP:function(){return p},aG:function(){return f.a}});var n=l(96469),a=l(49841),i=l(62715),r=l(81630),s=l(38497),o=l(45277),d=l(40511);function c(e){let{chart:t}=e,{mode:l}=(0,s.useContext)(o.p);return(0,n.jsx)("div",{className:"flex-1 min-w-0 p-4 bg-white dark:bg-theme-dark-container rounded",children:(0,n.jsxs)("div",{className:"h-full",children:[(0,n.jsx)("div",{className:"mb-2",children:t.chart_name}),(0,n.jsx)("div",{className:"opacity-80 text-sm mb-2",children:t.chart_desc}),(0,n.jsx)("div",{className:"h-[300px]",children:(0,n.jsx)(d.k,{style:{height:"100%"},options:{autoFit:!0,theme:l,type:"interval",data:t.values,encode:{x:"name",y:"value",color:"type"},axis:{x:{labelAutoRotate:!1}}}})})]})})}function u(e){let{chart:t}=e,{mode:l}=(0,s.useContext)(o.p);return(0,n.jsx)("div",{className:"flex-1 min-w-0 p-4 bg-white dark:bg-theme-dark-container rounded",children:(0,n.jsxs)("div",{className:"h-full",children:[(0,n.jsx)("div",{className:"mb-2",children:t.chart_name}),(0,n.jsx)("div",{className:"opacity-80 text-sm mb-2",children:t.chart_desc}),(0,n.jsx)("div",{className:"h-[300px]",children:(0,n.jsx)(d.k,{style:{height:"100%"},options:{autoFit:!0,theme:l,type:"view",data:t.values,children:[{type:"line",encode:{x:"name",y:"value",color:"type",shape:"smooth"}},{type:"area",encode:{x:"name",y:"value",color:"type",shape:"smooth"},legend:!1,style:{fillOpacity:.15}}],axis:{x:{labelAutoRotate:!1}}}})})]})})}var h=l(84832),v=l(44766);function m(e){var t,l;let{chart:a}=e,i=(0,v.groupBy)(a.values,"type");return(0,n.jsx)("div",{className:"flex-1 min-w-0 p-4 bg-white dark:bg-theme-dark-container rounded",children:(0,n.jsxs)("div",{className:"h-full",children:[(0,n.jsx)("div",{className:"mb-2",children:a.chart_name}),(0,n.jsx)("div",{className:"opacity-80 text-sm mb-2",children:a.chart_desc}),(0,n.jsx)("div",{className:"flex-1",children:(0,n.jsxs)(h.Z,{"aria-label":"basic table",stripe:"odd",hoverRow:!0,borderAxis:"bothBetween",children:[(0,n.jsx)("thead",{children:(0,n.jsx)("tr",{children:Object.keys(i).map(e=>(0,n.jsx)("th",{children:e},e))})}),(0,n.jsx)("tbody",{children:null===(t=Object.values(i))||void 0===t?void 0:null===(l=t[0])||void 0===l?void 0:l.map((e,t)=>{var l;return(0,n.jsx)("tr",{children:null===(l=Object.keys(i))||void 0===l?void 0:l.map(e=>{var l;return(0,n.jsx)("td",{children:(null==i?void 0:null===(l=i[e])||void 0===l?void 0:l[t].value)||""},e)})},t)})})]})})]})})}var f=l(93743),p=function(e){let{chartsData:t}=e,l=(0,s.useMemo)(()=>{if(t){let e=[],l=null==t?void 0:t.filter(e=>"IndicatorValue"===e.chart_type);l.length>0&&e.push({charts:l,type:"IndicatorValue"});let n=null==t?void 0:t.filter(e=>"IndicatorValue"!==e.chart_type),a=n.length,i=0;return[[0],[1],[2],[1,2],[1,3],[2,1,2],[2,1,3],[3,1,3],[3,2,3]][a].forEach(t=>{if(t>0){let l=n.slice(i,i+t);i+=t,e.push({charts:l})}}),e}},[t]);return(0,n.jsx)("div",{className:"flex flex-col gap-3",children:null==l?void 0:l.map((e,t)=>(0,n.jsx)("div",{className:"".concat((null==e?void 0:e.type)!=="IndicatorValue"?"flex gap-3":""),children:e.charts.map(e=>"IndicatorValue"===e.chart_type||"IndicatorValue"===e.type?(0,n.jsx)("div",{className:"flex flex-row gap-3",children:e.values.map(e=>(0,n.jsx)("div",{className:"flex-1",children:(0,n.jsx)(a.Z,{sx:{background:"transparent"},children:(0,n.jsxs)(i.Z,{className:"justify-around",children:[(0,n.jsx)(r.ZP,{gutterBottom:!0,component:"div",children:e.name}),(0,n.jsx)(r.ZP,{children:e.value})]})})},e.name))},e.chart_uid):"LineChart"===e.chart_type||"LineChart"===e.type?(0,n.jsx)(u,{chart:e},e.chart_uid):"BarChart"===e.chart_type||"BarChart"===e.type?(0,n.jsx)(c,{chart:e},e.chart_uid):"Table"===e.chart_type||"TableChartData"===e.type?(0,n.jsx)(m,{chart:e},e.chart_uid):void 0)},"chart_row_".concat(t)))})}},21601:function(e,t,l){l.r(t),l.d(t,{default:function(){return M}});var n=l(96469),a=l(94078),i=l(55763),r=l(95838),s=l(6319),o=l(90669),d=l(18521),c=l(51645),u=l(79355),h=l(75148),v=l(45875),m=l(38497),f=l(45045),p=l(53047),x=l(22672),y=function(){return(0,n.jsx)("svg",{width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 1024 1024",version:"1.1",children:(0,n.jsx)("path",{d:"M161.05472 919.3472h701.9008a58.71616 58.71616 0 0 0 58.65472-58.65472V180.40832a58.71616 58.71616 0 0 0-58.65472-58.65472H161.09568a58.03008 58.03008 0 0 0-41.4208 17.08032A58.1632 58.1632 0 0 0 102.4 180.30592v680.38656a58.64448 58.64448 0 0 0 58.65472 58.65472z m385.15712-589.568V190.08512h306.95424v660.93056H546.21184V329.7792zM170.83392 190.08512h306.95424v660.93056H170.83392V190.08512z"})})},g=function(){return(0,n.jsx)("svg",{width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 1024 1024",version:"1.1",children:(0,n.jsx)("path",{d:"M171.85792 110.9504a58.65472 58.65472 0 0 0-58.65472 58.65472v701.9008a58.7264 58.7264 0 0 0 58.65472 58.65472h680.28416a58.7264 58.7264 0 0 0 58.65472-58.65472V169.64608a57.98912 57.98912 0 0 0-17.08032-41.41056 58.1632 58.1632 0 0 0-41.472-17.27488H171.85792z m670.60736 750.77632H181.53472V554.77248h660.93056v306.95424z m0-375.38816H181.53472V179.38432h660.93056v306.95424z"})})},j=l(30405),_=l(36961),w=l(24956),b=l(66634),N=l(26869),C=l.n(N),k=l(76592);function Z(){return(0,n.jsxs)("svg",{viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",children:[(0,n.jsx)("path",{d:"M512 64c-247.424 0-448 62.72-448 140.032v112c0 77.312 200.576 139.968 448 139.968s448-62.72 448-140.032v-112C960 126.72 759.424 64 512 64z m0 728c-247.424 0-448-62.72-448-140.032v168.064C64 897.28 264.576 960 512 960s448-62.72 448-140.032v-167.936c0 77.312-200.576 139.968-448 139.968z",fill:"#3699FF"}),(0,n.jsx)("path",{d:"M512 540.032c-247.424 0-448-62.72-448-140.032v168c0 77.312 200.576 140.032 448 140.032s448-62.72 448-140.032V400c0 77.312-200.576 140.032-448 140.032z",fill:"#3699FF",opacity:".32"})]})}function O(){return(0,n.jsx)("svg",{viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",children:(0,n.jsx)("path",{d:"M39.385 204.83h346.571L252.054 976.74l-23.63 39.383h259.929v-31.506L614.379 204.83H771.91S960.951 220.584 984.581 0.038H236.3S94.52-7.84 39.384 204.83",fill:"#1296db"})})}function S(){return(0,n.jsxs)("svg",{viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",children:[(0,n.jsx)("path",{d:"M149.2 99.7h726.6c27.7 0 50.1 22.4 50.1 50.1V336H99.1V149.8c0-27.6 22.4-50.1 50.1-50.1z",fill:"#1ECD93"}),(0,n.jsx)("path",{d:"M99.1 395h236.2v236.3H99.1zM99.1 690.3h236.2v236.2H149.2c-27.7 0-50.1-22.4-50.1-50.1V690.3zM394.4 395h236.2v236.3H394.4z",fill:"#1ECD93",fillOpacity:".5"}),(0,n.jsx)("path",{d:"M394.4 690.3h236.2v236.3H394.4z",fill:"#A1E6C9","data-spm-anchor-id":"a313x.search_index.0.i13.27343a81CqKUWU"}),(0,n.jsx)("path",{d:"M689.7 395h236.2v236.3H689.7z",fill:"#1ECD93",fillOpacity:".5"}),(0,n.jsx)("path",{d:"M689.7 690.3h236.2v186.1c0 27.7-22.4 50.1-50.1 50.1H689.7V690.3z",fill:"#A1E6C9","data-spm-anchor-id":"a313x.search_index.0.i17.27343a81CqKUWU"})]})}let{Search:E}=s.default;function $(e){let{layout:t="LR",editorValue:l,chartData:a,tableData:i,tables:r,handleChange:s}=e,d=(0,m.useMemo)(()=>a?(0,n.jsx)("div",{className:"flex-1 overflow-auto p-2",style:{flexShrink:0,overflow:"hidden"},children:(0,n.jsx)(f.ZP,{chartsData:[a]})}):null,[a]),{columns:c,dataSource:u}=(0,m.useMemo)(()=>{let{columns:e=[],values:t=[]}=null!=i?i:{},l=e.map(e=>({key:e,dataIndex:e,title:e})),n=t.map(t=>t.reduce((t,l,n)=>(t[e[n]]=l,t),{}));return{columns:l,dataSource:n}},[i]),h=(0,m.useMemo)(()=>{let e={},t=null==r?void 0:r.data,l=null==t?void 0:t.children;return null==l||l.forEach(t=>{e[t.title]=t.children.map(e=>({columnName:e.title,columnType:e.type}))}),{getTableList:async e=>e&&e!==(null==t?void 0:t.title)?[]:(null==l?void 0:l.map(e=>e.title))||[],getTableColumns:async t=>e[t]||[],getSchemaList:async()=>(null==t?void 0:t.title)?[null==t?void 0:t.title]:[]}},[r]);return(0,n.jsxs)("div",{className:C()("flex w-full flex-1 h-full gap-2 overflow-hidden",{"flex-col":"TB"===t,"flex-row":"LR"===t}),children:[(0,n.jsx)("div",{className:"flex-1 flex overflow-hidden rounded",children:(0,n.jsx)(x.Z,{value:(null==l?void 0:l.sql)||"",language:"mysql",onChange:s,thoughts:(null==l?void 0:l.thoughts)||"",session:h})}),(0,n.jsxs)("div",{className:"flex-1 h-full overflow-auto bg-white dark:bg-theme-dark-container rounded p-4",children:[(null==i?void 0:i.values.length)?(0,n.jsx)(o.Z,{bordered:!0,scroll:{x:"auto"},rowKey:c[0].key,columns:c,dataSource:u}):(0,n.jsx)("div",{className:"h-full flex justify-center items-center",children:(0,n.jsx)(k.Z,{})}),d]})]})}var M=function(){var e,t,l,s,o;let[f,x]=(0,m.useState)([]),[N,k]=(0,m.useState)(""),[M,P]=(0,m.useState)(),[z,T]=(0,m.useState)(!0),[R,D]=(0,m.useState)(),[q,A]=(0,m.useState)(),[V,L]=(0,m.useState)(),[H,I]=(0,m.useState)(),[B,Q]=(0,m.useState)(),[F,K]=(0,m.useState)(!1),[G,U]=(0,m.useState)("TB"),W=(0,v.useSearchParams)(),J=null==W?void 0:W.get("id"),Y=null==W?void 0:W.get("scene"),{data:X}=(0,r.Z)(async()=>await (0,a.Tk)("/v1/editor/sql/rounds",{con_uid:J}),{onSuccess:e=>{var t,l;let n=null==e?void 0:null===(t=e.data)||void 0===t?void 0:t[(null==e?void 0:null===(l=e.data)||void 0===l?void 0:l.length)-1];n&&P(null==n?void 0:n.round)}}),{run:ee,loading:et}=(0,r.Z)(async()=>{var e,t;let l=null===(e=null==X?void 0:null===(t=X.data)||void 0===t?void 0:t.find(e=>e.round===M))||void 0===e?void 0:e.db_name;return await (0,a.PR)("/api/v1/editor/sql/run",{db_name:l,sql:null==V?void 0:V.sql})},{manual:!0,onSuccess:e=>{var t,l;I({columns:null==e?void 0:null===(t=e.data)||void 0===t?void 0:t.colunms,values:null==e?void 0:null===(l=e.data)||void 0===l?void 0:l.values})}}),{run:el,loading:en}=(0,r.Z)(async()=>{var e,t;let l=null===(e=null==X?void 0:null===(t=X.data)||void 0===t?void 0:t.find(e=>e.round===M))||void 0===e?void 0:e.db_name,n={db_name:l,sql:null==V?void 0:V.sql};return"chat_dashboard"===Y&&(n.chart_type=null==V?void 0:V.showcase),await (0,a.PR)("/api/v1/editor/chart/run",n)},{manual:!0,ready:!!(null==V?void 0:V.sql),onSuccess:e=>{if(null==e?void 0:e.success){var t,l,n,a,i,r,s;I({columns:(null==e?void 0:null===(t=e.data)||void 0===t?void 0:null===(l=t.sql_data)||void 0===l?void 0:l.colunms)||[],values:(null==e?void 0:null===(n=e.data)||void 0===n?void 0:null===(a=n.sql_data)||void 0===a?void 0:a.values)||[]}),(null==e?void 0:null===(i=e.data)||void 0===i?void 0:i.chart_values)?D({type:null==e?void 0:null===(r=e.data)||void 0===r?void 0:r.chart_type,values:null==e?void 0:null===(s=e.data)||void 0===s?void 0:s.chart_values,title:null==V?void 0:V.title,description:null==V?void 0:V.thoughts}):D(void 0)}}}),{run:ea,loading:ei}=(0,r.Z)(async()=>{var e,t,l,n,i;let r=null===(e=null==X?void 0:null===(t=X.data)||void 0===t?void 0:t.find(e=>e.round===M))||void 0===e?void 0:e.db_name;return await (0,a.PR)("/api/v1/sql/editor/submit",{conv_uid:J,db_name:r,conv_round:M,old_sql:null==q?void 0:q.sql,old_speak:null==q?void 0:q.thoughts,new_sql:null==V?void 0:V.sql,new_speak:(null===(l=null==V?void 0:null===(n=V.thoughts)||void 0===n?void 0:n.match(/^\n--(.*)\n\n$/))||void 0===l?void 0:null===(i=l[1])||void 0===i?void 0:i.trim())||(null==V?void 0:V.thoughts)})},{manual:!0,onSuccess:e=>{(null==e?void 0:e.success)&&ee()}}),{run:er,loading:es}=(0,r.Z)(async()=>{var e,t,l,n,i,r;let s=null===(e=null==X?void 0:null===(t=X.data)||void 0===t?void 0:t.find(e=>e.round===M))||void 0===e?void 0:e.db_name;return await (0,a.PR)("/api/v1/chart/editor/submit",{conv_uid:J,chart_title:null==V?void 0:V.title,db_name:s,old_sql:null==q?void 0:null===(l=q[null!=B?B:0])||void 0===l?void 0:l.sql,new_chart_type:null==V?void 0:V.showcase,new_sql:null==V?void 0:V.sql,new_comment:(null===(n=null==V?void 0:null===(i=V.thoughts)||void 0===i?void 0:i.match(/^\n--(.*)\n\n$/))||void 0===n?void 0:null===(r=n[1])||void 0===r?void 0:r.trim())||(null==V?void 0:V.thoughts),gmt_create:new Date().getTime()})},{manual:!0,onSuccess:e=>{(null==e?void 0:e.success)&&el()}}),{data:eo}=(0,r.Z)(async()=>{var e,t;let l=null===(e=null==X?void 0:null===(t=X.data)||void 0===t?void 0:t.find(e=>e.round===M))||void 0===e?void 0:e.db_name;return await (0,a.Tk)("/v1/editor/db/tables",{db_name:l,page_index:1,page_size:200})},{ready:!!(null===(e=null==X?void 0:null===(t=X.data)||void 0===t?void 0:t.find(e=>e.round===M))||void 0===e?void 0:e.db_name),refreshDeps:[null===(l=null==X?void 0:null===(s=X.data)||void 0===s?void 0:s.find(e=>e.round===M))||void 0===l?void 0:l.db_name]}),{run:ed}=(0,r.Z)(async e=>await (0,a.Tk)("/v1/editor/sql",{con_uid:J,round:e}),{manual:!0,onSuccess:e=>{let t;try{if(Array.isArray(null==e?void 0:e.data))t=null==e?void 0:e.data,Q(0);else if("string"==typeof(null==e?void 0:e.data)){let l=JSON.parse(null==e?void 0:e.data);t=l}else t=null==e?void 0:e.data}catch(e){console.log(e)}finally{A(t),Array.isArray(t)?L(null==t?void 0:t[Number(B||0)]):L(t)}}}),ec=(0,m.useMemo)(()=>{let e=(t,l)=>t.map(t=>{let a=t.title,i=a.indexOf(N),r=a.substring(0,i),s=a.slice(i+N.length),o=e=>{switch(e){case"db":return(0,n.jsx)(Z,{});case"table":return(0,n.jsx)(S,{});default:return(0,n.jsx)(O,{})}},c=i>-1?(0,n.jsx)(d.Z,{title:((null==t?void 0:t.comment)||(null==t?void 0:t.title))+((null==t?void 0:t.can_null)==="YES"?"(can null)":"(can't null)"),children:(0,n.jsxs)("div",{className:"flex items-center",children:[o(t.type),"\xa0\xa0\xa0",r,(0,n.jsx)("span",{className:"text-[#1677ff]",children:N}),s,"\xa0",(null==t?void 0:t.type)&&(0,n.jsx)("div",{className:"text-gray-400",children:null==t?void 0:t.type})]})}):(0,n.jsx)(d.Z,{title:((null==t?void 0:t.comment)||(null==t?void 0:t.title))+((null==t?void 0:t.can_null)==="YES"?"(can null)":"(can't null)"),children:(0,n.jsxs)("div",{className:"flex items-center",children:[o(t.type),"\xa0\xa0\xa0",a,"\xa0",(null==t?void 0:t.type)&&(0,n.jsx)("div",{className:"text-gray-400",children:null==t?void 0:t.type})]})});if(t.children){let n=l?String(l)+"_"+t.key:t.key;return{title:a,showTitle:c,key:n,children:e(t.children,n)}}return{title:a,showTitle:c,key:t.key}});return(null==eo?void 0:eo.data)?(x([null==eo?void 0:eo.data.key]),e([null==eo?void 0:eo.data])):[]},[N,eo]),eu=(0,m.useMemo)(()=>{let e=[],t=(l,n)=>{if(l&&!((null==l?void 0:l.length)<=0))for(let a=0;a<l.length;a++){let i=l[a],{key:r,title:s}=i;e.push({key:r,title:s,parentKey:n}),i.children&&t(i.children,r)}};return ec&&t(ec),e},[ec]),eh=(e,t)=>{let l;for(let n=0;n<t.length;n++){let a=t[n];a.children&&(a.children.some(t=>t.key===e)?l=a.key:eh(e,a.children)&&(l=eh(e,a.children)))}return l};function ev(e){let t;if(!e)return{sql:"",thoughts:""};let l=e&&e.match(/(--.*)?\n?([\s\S]*)/),n="";return l&&l.length>=3&&(n=l[1],t=l[2]),{sql:t,thoughts:n}}return(0,m.useEffect)(()=>{M&&ed(M)},[ed,M]),(0,m.useEffect)(()=>{q&&"chat_dashboard"===Y&&B&&el()},[B,Y,q,el]),(0,m.useEffect)(()=>{q&&"chat_dashboard"!==Y&&ee()},[Y,q,ee]),(0,n.jsxs)("div",{className:"flex flex-col w-full h-full overflow-hidden",children:[(0,n.jsx)(p.Z,{}),(0,n.jsxs)("div",{className:"relative flex flex-1 p-4 pt-0 overflow-hidden",children:[(0,n.jsxs)("div",{className:"relative flex overflow-hidden mr-4",children:[(0,n.jsx)("div",{className:C()("h-full relative transition-[width] overflow-hidden",{"w-0":F,"w-64":!F}),children:(0,n.jsxs)("div",{className:"relative w-64 h-full overflow-hidden flex flex-col rounded bg-white dark:bg-theme-dark-container p-4",children:[(0,n.jsx)(c.default,{size:"middle",className:"w-full mb-2",value:M,options:null==X?void 0:null===(o=X.data)||void 0===o?void 0:o.map(e=>({label:e.round_name,value:e.round})),onChange:e=>{P(e)}}),(0,n.jsx)(E,{className:"mb-2",placeholder:"Search",onChange:e=>{let{value:t}=e.target;if(null==eo?void 0:eo.data){if(t){let e=eu.map(e=>e.title.indexOf(t)>-1?eh(e.key,ec):null).filter((e,t,l)=>e&&l.indexOf(e)===t);x(e)}else x([]);k(t),T(!0)}}}),ec&&ec.length>0&&(0,n.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,n.jsx)(u.Z,{onExpand:e=>{x(e),T(!1)},expandedKeys:f,autoExpandParent:z,treeData:ec,fieldNames:{title:"showTitle"}})})]})}),(0,n.jsx)("div",{className:"absolute right-0 top-0 translate-x-full h-full flex items-center justify-center opacity-0 hover:opacity-100 group-hover/side:opacity-100 transition-opacity",children:(0,n.jsx)("div",{className:"bg-white w-4 h-10 flex items-center justify-center dark:bg-theme-dark-container rounded-tr rounded-br z-10 text-xs cursor-pointer shadow-[4px_0_10px_rgba(0,0,0,0.06)] text-opacity-80",onClick:()=>{K(!F)},children:F?(0,n.jsx)(_.Z,{}):(0,n.jsx)(j.Z,{})})})]}),(0,n.jsxs)("div",{className:"flex flex-col flex-1 max-w-full overflow-hidden",children:[(0,n.jsxs)("div",{className:"mb-2 bg-white dark:bg-theme-dark-container p-2 flex justify-between items-center",children:[(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)(h.ZP,{className:"text-xs rounded-none",size:"small",type:"primary",icon:(0,n.jsx)(w.Z,{}),loading:et||en,onClick:async()=>{"chat_dashboard"===Y?el():ee()},children:"Run"}),(0,n.jsx)(h.ZP,{className:"text-xs rounded-none",type:"primary",size:"small",loading:ei||es,icon:(0,n.jsx)(b.Z,{}),onClick:async()=>{"chat_dashboard"===Y?await er():await ea()},children:"Save"})]}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)(i.Z,{className:C()("flex items-center justify-center w-6 h-6 text-lg rounded",{"bg-theme-primary bg-opacity-10":"TB"===G}),component:g,onClick:()=>{U("TB")}}),(0,n.jsx)(i.Z,{className:C()("flex items-center justify-center w-6 h-6 text-lg rounded",{"bg-theme-primary bg-opacity-10":"LR"===G}),component:y,onClick:()=>{U("LR")}})]})]}),Array.isArray(q)?(0,n.jsxs)("div",{className:"flex flex-col h-full overflow-hidden",children:[(0,n.jsx)("div",{className:"w-full whitespace-nowrap overflow-x-auto bg-white dark:bg-theme-dark-container mb-2 text-[0px]",children:q.map((e,t)=>(0,n.jsx)(d.Z,{className:"inline-block",title:e.title,children:(0,n.jsx)("div",{className:C()("max-w-[240px] px-3 h-10 text-ellipsis overflow-hidden whitespace-nowrap text-sm leading-10 cursor-pointer font-semibold hover:text-theme-primary transition-colors mr-2 last-of-type:mr-0",{"border-b-2 border-solid border-theme-primary text-theme-primary":B===t}),onClick:()=>{Q(t),L(null==q?void 0:q[t])},children:e.title})},e.title))}),(0,n.jsx)("div",{className:"flex flex-1 overflow-hidden",children:q.map((e,t)=>(0,n.jsx)("div",{className:C()("w-full overflow-hidden",{hidden:t!==B,"block flex-1":t===B}),children:(0,n.jsx)($,{layout:G,editorValue:e,handleChange:e=>{let{sql:t,thoughts:l}=ev(e);L(e=>Object.assign({},e,{sql:t,thoughts:l}))},tableData:H,chartData:R})},e.title))})]}):(0,n.jsx)($,{layout:G,editorValue:q,handleChange:e=>{let{sql:t,thoughts:l}=ev(e);L(e=>Object.assign({},e,{sql:t,thoughts:l}))},tableData:H,chartData:void 0,tables:eo})]})]})]})}},29244:function(e,t,l){l.d(t,{Z:function(){return r}});var n=l(12803),a=l(23241),i=l(33478);function r(e,t,l){return t=(0,n.Z)(t),(0,i.Z)(e,(0,a.Z)()?Reflect.construct(t,l||[],(0,n.Z)(e).constructor):t.apply(e,l))}},53659:function(e,t,l){l.d(t,{Z:function(){return n}});function n(e){if(null==e)throw TypeError("Cannot destructure "+e)}}}]);